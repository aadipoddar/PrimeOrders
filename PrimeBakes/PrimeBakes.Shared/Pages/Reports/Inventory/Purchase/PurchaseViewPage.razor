@page "/Inventory/Purchase/View/{PurchaseId:int}"

@using PrimeBakesLibrary.Models.Inventory
@using PrimeBakesLibrary.Models.Common
@using PrimeBakesLibrary.Models.Accounts.Masters
@using Syncfusion.Blazor.Buttons
@using Syncfusion.Blazor.Grids
@using Syncfusion.Blazor.Popups
@using PrimeBakes.Shared.Services
@using Microsoft.AspNetCore.Components.Web

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css" />

<PageTitle>Purchase Details - @(_purchaseOverview?.BillNo?? "Loading...") - PrimeBakes</PageTitle>

@if (_isLoading)
{
    <div class="loading-overlay">
        <div class="loading-content">
            <div class="circular-dots-loader">
                <span class="dot dot-1"></span>
                <span class="dot dot-2"></span>
                <span class="dot dot-3"></span>
            </div>
            <p class="loading-text">Loading Purchase Details...</p>
        </div>
    </div>
}
else if (_purchaseOverview == null)
{
    <div class="error-container">
        <div class="error-content">
            <i class="fas fa-exclamation-triangle"></i>
            <h3>Purchase Not Found</h3>
            <p>The requested purchase could not be found or may have been deleted.</p>
            <button @onclick='() => NavigationManager.NavigateTo("/Reports/Purchase")' class="back-btn">
                <i class="fas fa-arrow-left"></i>
                Go Back
            </button>
        </div>
    </div>
}
else
{
    <div class="purchase-view-container">
        <!-- Header Section -->
        <div class="page-header">
            <div class="header-content">
                <div class="header-left">
                    <button @onclick='() => NavigationManager.NavigateTo("/Reports/Purchase")' class="back-btn-header">
                        <i class="fas fa-arrow-left"></i>
                        <span>Back</span>
                    </button>
                    <div class="header-title">
                        <div class="title-icon">
                            <i class="fas fa-shopping-cart"></i>
                        </div>
                        <div class="title-info">
                            <h1>Purchase Details</h1>
                            <p>Bill No: @_purchaseOverview.BillNo</p>
                        </div>
                    </div>
                </div>
                
                <div class="header-actions">
                    <button @onclick="EditPurchase" class="action-btn edit-btn">
                        <i class="fas fa-edit"></i>
                        <span>Edit</span>
                    </button>
                    
                    <button @onclick="DeletePurchase" class="action-btn delete-btn" disabled="@_isProcessing">
                        <i class="fas fa-trash-alt"></i>
                        <span>Delete</span>
                    </button>
                    
                    <button @onclick="PrintPurchase" class="action-btn print-btn">
                        <i class="fas fa-print"></i>
                        <span>Print</span>
                    </button>
                </div>
            </div>
        </div>

        <!-- Purchase Overview Cards -->
        <div class="overview-section">
            <div class="overview-cards">
                <!-- Bill Information Card -->
                <div class="overview-card primary-card">
                    <div class="card-header">
                        <div class="card-icon">
                            <i class="fas fa-file-invoice"></i>
                        </div>
                        <div class="card-title">
                            <h3>Bill Information</h3>
                        </div>
                    </div>
                    <div class="card-content">
                        <div class="info-row">
                            <span class="info-label">Bill No:</span>
                            <span class="info-value bill-no">@_purchaseOverview.BillNo</span>
                        </div>
                        <div class="info-row">
                            <span class="info-label">Date:</span>
                            <span class="info-value">@_purchaseOverview.BillDateTime.ToString("dd MMM yyyy, hh:mm tt")</span>
                        </div>
                        <div class="info-row">
                            <span class="info-label">Created By:</span>
                            <span class="info-value">@_purchaseOverview.UserName</span>
                        </div>
                        <div class="info-row">
                            <span class="info-label">Created On:</span>
                            <span class="info-value">@_purchaseOverview.CreatedAt.ToString("dd MMM yyyy, hh:mm tt")</span>
                        </div>
                    </div>
                </div>

                <!-- Supplier Information Card -->
                <div class="overview-card">
                    <div class="card-header">
                        <div class="card-icon">
                            <i class="fas fa-truck"></i>
                        </div>
                        <div class="card-title">
                            <h3>Supplier Information</h3>
                        </div>
                    </div>
                    <div class="card-content">
                        <div class="info-row">
                            <span class="info-label">Supplier:</span>
                            <span class="info-value supplier-name">@_purchaseOverview.SupplierName</span>
                        </div>
                        <div class="info-row">
                            <span class="info-label">Supplier ID:</span>
                            <span class="info-value">@_purchaseOverview.SupplierId</span>
                        </div>
                    </div>
                </div>

                <!-- Purchase Summary Card -->
                <div class="overview-card highlight-card">
                    <div class="card-header">
                        <div class="card-icon">
                            <i class="fas fa-calculator"></i>
                        </div>
                        <div class="card-title">
                            <h3>Purchase Summary</h3>
                        </div>
                    </div>
                    <div class="card-content">
                        <div class="info-row">
                            <span class="info-label">Total Items:</span>
                            <span class="info-value">@_purchaseOverview.TotalItems</span>
                        </div>
                        <div class="info-row">
                            <span class="info-label">Total Quantity:</span>
                            <span class="info-value">@_purchaseOverview.TotalQuantity.ToString("N2")</span>
                        </div>
                        <div class="info-row">
                            <span class="info-label">Base Total:</span>
                            <span class="info-value">₹@_purchaseOverview.BaseTotal.ToString("N2")</span>
                        </div>
                        <div class="info-row total-row">
                            <span class="info-label">Final Total:</span>
                            <span class="info-value total-amount">₹@_purchaseOverview.Total.ToString("N2")</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Financial Breakdown Section -->
        <div class="financial-section">
            <div class="section-header">
                <h2><i class="fas fa-receipt"></i> Financial Breakdown</h2>
            </div>
            
            <div class="financial-cards">
                <div class="financial-card">
                    <div class="financial-icon">
                        <i class="fas fa-calculator"></i>
                    </div>
                    <div class="financial-content">
                        <div class="financial-label">Base Total</div>
                        <div class="financial-value">₹@_purchaseOverview.BaseTotal.ToString("N2")</div>
                    </div>
                </div>
                
                <div class="financial-card">
                    <div class="financial-icon discount">
                        <i class="fas fa-percentage"></i>
                    </div>
                    <div class="financial-content">
                        <div class="financial-label">Item Discount</div>
                        <div class="financial-value discount-value">-₹@_purchaseOverview.DiscountAmount.ToString("N2")</div>
                    </div>
                </div>
                
                <div class="financial-card">
                    <div class="financial-icon">
                        <i class="fas fa-equals"></i>
                    </div>
                    <div class="financial-content">
                        <div class="financial-label">Sub Total</div>
                        <div class="financial-value">₹@_purchaseOverview.SubTotal.ToString("N2")</div>
                    </div>
                </div>
                
                <div class="financial-card">
                    <div class="financial-icon tax">
                        <i class="fas fa-file-invoice-dollar"></i>
                    </div>
                    <div class="financial-content">
                        <div class="financial-label">Total Tax</div>
                        <div class="financial-value tax-value">₹@_purchaseOverview.TotalTaxAmount.ToString("N2")</div>
                    </div>
                </div>
                
                <div class="financial-card">
                    <div class="financial-icon discount">
                        <i class="fas fa-hand-holding-usd"></i>
                    </div>
                    <div class="financial-content">
                        <div class="financial-label">Cash Discount (@_purchaseOverview.CashDiscountPercent.ToString("N1")%)</div>
                        <div class="financial-value discount-value">-₹@_purchaseOverview.CashDiscountAmount.ToString("N2")</div>
                    </div>
                </div>
                
                <div class="financial-card highlight">
                    <div class="financial-icon">
                        <i class="fas fa-rupee-sign"></i>
                    </div>
                    <div class="financial-content">
                        <div class="financial-label">Final Total</div>
                        <div class="financial-value total">₹@_purchaseOverview.Total.ToString("N2")</div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Tax Breakdown Section -->
        @if (_purchaseOverview.TotalTaxAmount > 0)
        {
            <div class="tax-section">
                <div class="section-header">
                    <h2><i class="fas fa-percentage"></i> Tax Breakdown</h2>
                </div>
                
                <div class="tax-breakdown">
                    @if (_purchaseOverview.CGSTAmount > 0)
                    {
                        <div class="tax-item">
                            <div class="tax-label">CGST (@_purchaseOverview.CGSTPercent.ToString("N1")%)</div>
                            <div class="tax-value">₹@_purchaseOverview.CGSTAmount.ToString("N2")</div>
                        </div>
                    }
                    
                    @if (_purchaseOverview.SGSTAmount > 0)
                    {
                        <div class="tax-item">
                            <div class="tax-label">SGST (@_purchaseOverview.SGSTPercent.ToString("N1")%)</div>
                            <div class="tax-value">₹@_purchaseOverview.SGSTAmount.ToString("N2")</div>
                        </div>
                    }
                    
                    @if (_purchaseOverview.IGSTAmount > 0)
                    {
                        <div class="tax-item">
                            <div class="tax-label">IGST (@_purchaseOverview.IGSTPercent.ToString("N1")%)</div>
                            <div class="tax-value">₹@_purchaseOverview.IGSTAmount.ToString("N2")</div>
                        </div>
                    }
                </div>
            </div>
        }

        <!-- Purchase Items Details -->
        <div class="items-section">
            <div class="section-header">
                <h2><i class="fas fa-list"></i> Purchase Items (@_purchaseDetails.Count items)</h2>
            </div>
            
            <div class="items-grid">
                <SfGrid DataSource="_purchaseDetails"
                        AllowSorting="true"
                        AllowResizing="true"
                        CssClass="modern-grid">
                    <GridColumns>
                        <GridColumn Field="@nameof(PurchaseDetailModel.Id)" 
                                   HeaderText="#" 
                                   Width="60" 
                                   TextAlign="TextAlign.Center" />
                        
                        <GridColumn HeaderText="Raw Material" 
                                   Width="200">
                            <Template>
                                @{
                                    var detail = (context as PurchaseDetailModel);
                                    var rawMaterial = GetRawMaterialName(detail.RawMaterialId);
                                }
                                <div class="raw-material-cell">
                                    <div class="raw-material-name">@rawMaterial</div>
                                    <div class="raw-material-id">ID: @detail.RawMaterialId</div>
                                </div>
                            </Template>
                        </GridColumn>
                        
                        <GridColumn Field="@nameof(PurchaseDetailModel.Quantity)" 
                                   HeaderText="Quantity" 
                                   Width="100" 
                                   Format="N2" 
                                   TextAlign="TextAlign.Right" />
                        
                        <GridColumn Field="@nameof(PurchaseDetailModel.MeasurementUnit)" 
                                   HeaderText="Unit" 
                                   Width="80" 
                                   TextAlign="TextAlign.Center" />
                        
                        <GridColumn Field="@nameof(PurchaseDetailModel.Rate)" 
                                   HeaderText="Rate" 
                                   Width="100" 
                                   Format="C2" 
                                   TextAlign="TextAlign.Right" />
                        
                        <GridColumn Field="@nameof(PurchaseDetailModel.BaseTotal)" 
                                   HeaderText="Base Total" 
                                   Width="120" 
                                   Format="C2" 
                                   TextAlign="TextAlign.Right" />
                        
                        <GridColumn Field="@nameof(PurchaseDetailModel.DiscPercent)" 
                                   HeaderText="Disc %" 
                                   Width="80" 
                                   Format="N2" 
                                   TextAlign="TextAlign.Right" />
                        
                        <GridColumn Field="@nameof(PurchaseDetailModel.DiscAmount)" 
                                   HeaderText="Disc Amt" 
                                   Width="100" 
                                   Format="C2" 
                                   TextAlign="TextAlign.Right" />
                        
                        <GridColumn Field="@nameof(PurchaseDetailModel.AfterDiscount)" 
                                   HeaderText="After Disc" 
                                   Width="120" 
                                   Format="C2" 
                                   TextAlign="TextAlign.Right" />
                        
                        <GridColumn HeaderText="Tax Details" 
                                   Width="150">
                            <Template>
                                @{
                                    var detail = (context as PurchaseDetailModel);
                                }
                                <div class="tax-details-cell">
                                    @if (detail.CGSTAmount > 0)
                                    {
                                        <div class="tax-row">CGST: ₹@detail.CGSTAmount.ToString("N2")</div>
                                    }
                                    @if (detail.SGSTAmount > 0)
                                    {
                                        <div class="tax-row">SGST: ₹@detail.SGSTAmount.ToString("N2")</div>
                                    }
                                    @if (detail.IGSTAmount > 0)
                                    {
                                        <div class="tax-row">IGST: ₹@detail.IGSTAmount.ToString("N2")</div>
                                    }
                                </div>
                            </Template>
                        </GridColumn>
                        
                        <GridColumn Field="@nameof(PurchaseDetailModel.Total)" 
                                   HeaderText="Total" 
                                   Width="120" 
                                   Format="C2" 
                                   TextAlign="TextAlign.Right">
                            <Template>
                                @{
                                    var detail = (context as PurchaseDetailModel);
                                }
                                <div class="total-cell">
                                    <span class="total-amount">₹@detail.Total.ToString("N2")</span>
                                </div>
                            </Template>
                        </GridColumn>
                    </GridColumns>
                </SfGrid>
            </div>
        </div>

        <!-- Remarks Section -->
        @if (!string.IsNullOrWhiteSpace(_purchaseOverview.Remarks))
        {
            <div class="remarks-section">
                <div class="section-header">
                    <h2><i class="fas fa-comment"></i> Remarks</h2>
                </div>
                
                <div class="remarks-content">
                    <p>@_purchaseOverview.Remarks</p>
                </div>
            </div>
        }
    </div>
}

<!-- Confirm Delete Dialog -->
<SfDialog @ref="_confirmDeleteDialog"
          Width="500px"
          IsModal="true"
          ShowCloseIcon="false"
          @bind-Visible="_showDeleteDialog"
          CssClass="confirm-delete-dialog">
    <DialogTemplates>
        <Header>
            <div class="dialog-header">
                <div class="dialog-icon danger">
                    <i class="fas fa-exclamation-triangle"></i>
                </div>
                <div class="dialog-title">
                    <h3>Confirm Delete</h3>
                </div>
            </div>
        </Header>
        <Content>
            <div class="dialog-content">
                <div class="warning-message">
                    <p><strong>Are you sure you want to delete this purchase?</strong></p>
                    
                    @if (_purchaseOverview != null)
                    {
                        <div class="delete-details">
                            <div class="detail-row">
                                <span class="label">Bill No:</span>
                                <span class="value">@_purchaseOverview.BillNo</span>
                            </div>
                            <div class="detail-row">
                                <span class="label">Supplier:</span>
                                <span class="value">@_purchaseOverview.SupplierName</span>
                            </div>
                            <div class="detail-row">
                                <span class="label">Date:</span>
                                <span class="value">@_purchaseOverview.BillDateTime.ToString("dd MMM yyyy")</span>
                            </div>
                            <div class="detail-row">
                                <span class="label">Amount:</span>
                                <span class="value amount">₹@_purchaseOverview.Total.ToString("N2")</span>
                            </div>
                        </div>
                    }
                    
                    <div class="warning-note">
                        <i class="fas fa-info-circle"></i>
                        <span>This action will mark the purchase as deleted and reverse associated stock and accounting entries. This action cannot be undone.</span>
                    </div>
                </div>
            </div>
        </Content>
        <FooterTemplate>
            <div class="dialog-footer">
                <button @onclick="CancelDelete" class="btn btn-cancel" disabled="@_isProcessing">
                    <i class="fas fa-times"></i>
                    <span>Cancel</span>
                </button>
                <button @onclick="ConfirmDelete" class="btn btn-delete" disabled="@_isProcessing">
                    @if (_isProcessing)
                    {
                        <i class="fas fa-spinner fa-spin"></i>
                        <span>Deleting...</span>
                    }
                    else
                    {
                        <i class="fas fa-trash-alt"></i>
                        <span>Delete Purchase</span>
                    }
                </button>
            </div>
        </FooterTemplate>
    </DialogTemplates>
</SfDialog>

<style>
    :root {
        --primary-color: #1976d2;
        --primary-light: rgba(25, 118, 210, 0.1);
        --primary-dark: #1565c0;
        --secondary-color: #bbdefb;
        --accent-color: #2196f3;
        --success-color: #4caf50;
        --warning-color: #ff9800;
        --danger-color: #f44336;
        --dark-color: #2c2c54;
        --light-color: #f3f8ff;
        --white: #ffffff;
        --shadow: 0 2px 8px rgba(25, 118, 210, 0.15);
        --shadow-lg: 0 8px 25px rgba(25, 118, 210, 0.2);
        --border-radius: 0.5rem;
        --border-radius-lg: 0.75rem;
        --transition: all 0.3s ease;
    }

    .purchase-view-container {
        padding: 20px;
        background: 
            radial-gradient(circle at 15% 15%, rgba(25, 118, 210, 0.05) 0%, transparent 50%),
            radial-gradient(circle at 85% 85%, rgba(33, 150, 243, 0.08) 0%, transparent 50%),
            linear-gradient(135deg, #f3f8ff 0%, #e3f2fd 30%, #bbdefb 70%, #90caf9 100%);
        min-height: 100vh;
        animation: fadeInUp 0.6s ease-out;
    }

    /* Loading States */
    .loading-overlay {
        position: fixed;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background: rgba(255, 255, 255, 0.95);
        display: flex;
        align-items: center;
        justify-content: center;
        z-index: 9999;
        backdrop-filter: blur(8px);
    }

    .loading-content {
        text-align: center;
        padding: 40px;
        background: var(--white);
        border-radius: var(--border-radius-lg);
        box-shadow: var(--shadow-lg);
        border: 1px solid rgba(25, 118, 210, 0.1);
    }

    .circular-dots-loader {
        display: inline-block;
        position: relative;
        width: 60px;
        height: 60px;
        margin-bottom: 25px;
    }

    .circular-dots-loader .dot {
        display: block;
        position: absolute;
        width: 14px;
        height: 14px;
        border-radius: 50%;
        background: var(--primary-color);
        animation: dotPulse 1.4s infinite ease-in-out both;
    }

    .circular-dots-loader .dot-1 {
        top: 0;
        left: 50%;
        transform: translateX(-50%);
        animation-delay: -0.8s;
    }

    .circular-dots-loader .dot-2 {
        top: 50%;
        right: 0;
        transform: translateY(-50%);
        animation-delay: -0.4s;
    }

    .circular-dots-loader .dot-3 {
        bottom: 0;
        left: 50%;
        transform: translateX(-50%);
        animation-delay: 0s;
    }

    .loading-text {
        color: var(--dark-color);
        font-size: 18px;
        font-weight: 600;
        margin: 0;
    }

    /* Error States */
    .error-container {
        display: flex;
        align-items: center;
        justify-content: center;
        min-height: 100vh;
        padding: 20px;
    }

    .error-content {
        text-align: center;
        background: var(--white);
        padding: 60px 40px;
        border-radius: var(--border-radius-lg);
        box-shadow: var(--shadow-lg);
        border: 2px dashed rgba(244, 67, 54, 0.3);
        max-width: 400px;
    }

    .error-content i {
        font-size: 64px;
        color: var(--danger-color);
        margin-bottom: 20px;
    }

    .error-content h3 {
        color: var(--dark-color);
        margin-bottom: 15px;
        font-size: 24px;
    }

    .error-content p {
        color: #666;
        margin-bottom: 30px;
        font-size: 16px;
    }

    /* Header Section */
    .page-header {
        margin-bottom: 30px;
        background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
        border-radius: var(--border-radius-lg);
        padding: 30px;
        color: var(--white);
        box-shadow: var(--shadow-lg);
        position: relative;
        overflow: hidden;
    }

    .page-header::before {
        content: '';
        position: absolute;
        top: -50%;
        right: -20%;
        width: 200px;
        height: 200px;
        background: rgba(255, 255, 255, 0.1);
        border-radius: 50%;
        animation: float 6s ease-in-out infinite;
    }

    .header-content {
        display: flex;
        justify-content: space-between;
        align-items: center;
        position: relative;
        z-index: 2;
    }

    .header-left {
        display: flex;
        align-items: center;
        gap: 20px;
    }

    .back-btn-header {
        display: flex;
        align-items: center;
        gap: 8px;
        padding: 12px 16px;
        background: rgba(255, 255, 255, 0.2);
        color: var(--white);
        border: none;
        border-radius: var(--border-radius);
        font-size: 14px;
        font-weight: 600;
        cursor: pointer;
        transition: var(--transition);
        backdrop-filter: blur(10px);
        border: 1px solid rgba(255, 255, 255, 0.2);
    }

    .back-btn-header:hover {
        background: rgba(255, 255, 255, 0.3);
        transform: translateY(-2px);
    }

    .header-title {
        display: flex;
        align-items: center;
        gap: 20px;
    }

    .title-icon {
        width: 60px;
        height: 60px;
        background: rgba(255, 255, 255, 0.2);
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 24px;
        backdrop-filter: blur(10px);
    }

    .title-info h1 {
        margin: 0 0 5px 0;
        font-size: 28px;
        font-weight: 700;
        text-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
    }

    .title-info p {
        margin: 0;
        font-size: 16px;
        opacity: 0.9;
        font-weight: 400;
    }

    .header-actions {
        display: flex;
        gap: 12px;
    }

    .action-btn {
        display: flex;
        align-items: center;
        gap: 8px;
        padding: 12px 18px;
        border: none;
        border-radius: var(--border-radius);
        font-size: 14px;
        font-weight: 600;
        cursor: pointer;
        transition: var(--transition);
        text-decoration: none;
    }

    .edit-btn {
        background: rgba(255, 255, 255, 0.2);
        color: var(--white);
        border: 1px solid rgba(255, 255, 255, 0.3);
    }

    .edit-btn:hover {
        background: rgba(255, 255, 255, 0.3);
        transform: translateY(-2px);
    }
    
    .delete-btn {
        background: var(--danger-color);
        color: var(--white);
        border: 1px solid var(--danger-color);
    }

    .delete-btn:hover {
        background: #d32f2f;
        transform: translateY(-2px);
    }
    
    .delete-btn:disabled {
        background: #ccc;
        color: #666;
        cursor: not-allowed;
        transform: none;
    }

    .print-btn {
        background: rgba(255, 255, 255, 0.2);
        color: var(--white);
        border: 1px solid rgba(255, 255, 255, 0.3);
    }

    .print-btn:hover {
        background: rgba(255, 255, 255, 0.3);
        transform: translateY(-2px);
    }

    .export-btn {
        background: var(--success-color);
        color: var(--white);
    }

    .export-btn:hover {
        background: #45a049;
        transform: translateY(-2px);
    }

    .back-btn {
        display: flex;
        align-items: center;
        gap: 8px;
        padding: 12px 20px;
        background: var(--primary-color);
        color: var(--white);
        border: none;
        border-radius: var(--border-radius);
        font-size: 14px;
        font-weight: 600;
        cursor: pointer;
        transition: var(--transition);
    }

    .back-btn:hover {
        background: var(--primary-dark);
        transform: translateY(-2px);
    }

    /* Overview Section */
    .overview-section {
        margin-bottom: 30px;
    }

    .overview-cards {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
        gap: 20px;
    }

    .overview-card {
        background: var(--white);
        border-radius: var(--border-radius-lg);
        padding: 25px;
        box-shadow: var(--shadow);
        border: 1px solid rgba(25, 118, 210, 0.1);
        transition: var(--transition);
        position: relative;
        overflow: hidden;
    }

    .overview-card::before {
        content: '';
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        height: 4px;
        background: linear-gradient(90deg, var(--primary-color), var(--secondary-color));
    }

    .overview-card:hover {
        transform: translateY(-3px);
        box-shadow: var(--shadow-lg);
    }

    .overview-card.primary-card::before {
        background: linear-gradient(90deg, var(--primary-color), var(--primary-dark));
    }

    .overview-card.highlight-card {
        background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
        color: var(--white);
        border: none;
    }

    .overview-card.highlight-card::before {
        background: rgba(255, 255, 255, 0.3);
    }

    .card-header {
        display: flex;
        align-items: center;
        gap: 15px;
        margin-bottom: 20px;
        padding-bottom: 15px;
        border-bottom: 2px solid var(--primary-light);
    }

    .highlight-card .card-header {
        border-bottom-color: rgba(255, 255, 255, 0.3);
    }

    .card-icon {
        width: 50px;
        height: 50px;
        background: var(--primary-light);
        color: var(--primary-color);
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 20px;
    }

    .highlight-card .card-icon {
        background: rgba(255, 255, 255, 0.2);
        color: var(--white);
    }

    .card-title h3 {
        margin: 0;
        font-size: 18px;
        font-weight: 700;
        color: var(--dark-color);
    }

    .highlight-card .card-title h3 {
        color: var(--white);
    }

    .card-content {
        display: flex;
        flex-direction: column;
        gap: 12px;
    }

    .info-row {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 8px 0;
        border-bottom: 1px solid #f0f0f0;
    }

    .highlight-card .info-row {
        border-bottom-color: rgba(255, 255, 255, 0.2);
    }

    .info-row:last-child {
        border-bottom: none;
    }

    .info-label {
        font-weight: 600;
        color: var(--dark-color);
        font-size: 14px;
    }

    .highlight-card .info-label {
        color: rgba(255, 255, 255, 0.9);
    }

    .info-value {
        font-weight: 700;
        color: var(--primary-color);
        font-size: 14px;
    }

    .highlight-card .info-value {
        color: var(--white);
    }

    .bill-no {
        font-size: 16px;
        background: var(--primary-light);
        padding: 4px 8px;
        border-radius: 4px;
    }

    .supplier-name {
        font-size: 16px;
        color: var(--success-color);
    }

    .total-row {
        border-top: 2px solid var(--primary-color);
        padding-top: 12px;
        margin-top: 8px;
    }

    .highlight-card .total-row {
        border-top-color: rgba(255, 255, 255, 0.4);
    }

    .total-amount {
        font-size: 18px;
        font-weight: 700;
    }

    /* Financial Section */
    .financial-section {
        margin-bottom: 30px;
    }

    .section-header {
        margin-bottom: 20px;
    }

    .section-header h2 {
        display: flex;
        align-items: center;
        gap: 12px;
        font-size: 24px;
        font-weight: 700;
        color: var(--dark-color);
        margin: 0;
    }

    .section-header h2 i {
        color: var(--primary-color);
    }

    .financial-cards {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
        gap: 15px;
    }

    .financial-card {
        background: var(--white);
        border-radius: var(--border-radius);
        padding: 20px;
        box-shadow: var(--shadow);
        border: 1px solid rgba(25, 118, 210, 0.1);
        display: flex;
        align-items: center;
        gap: 15px;
        transition: var(--transition);
    }

    .financial-card:hover {
        transform: translateY(-2px);
        box-shadow: var(--shadow-lg);
    }

    .financial-card.highlight {
        background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
        color: var(--white);
        border: none;
    }

    .financial-icon {
        width: 45px;
        height: 45px;
        border-radius: 50%;
        background: var(--primary-light);
        color: var(--primary-color);
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 18px;
        flex-shrink: 0;
    }

    .financial-icon.discount {
        background: rgba(255, 152, 0, 0.1);
        color: var(--warning-color);
    }

    .financial-icon.tax {
        background: rgba(76, 175, 80, 0.1);
        color: var(--success-color);
    }

    .financial-card.highlight .financial-icon {
        background: rgba(255, 255, 255, 0.2);
        color: var(--white);
    }

    .financial-content {
        flex: 1;
    }

    .financial-label {
        font-size: 13px;
        font-weight: 600;
        color: var(--dark-color);
        margin-bottom: 5px;
    }

    .financial-card.highlight .financial-label {
        color: rgba(255, 255, 255, 0.9);
    }

    .financial-value {
        font-size: 16px;
        font-weight: 700;
        color: var(--primary-color);
    }

    .financial-value.discount-value {
        color: var(--warning-color);
    }

    .financial-value.tax-value {
        color: var(--success-color);
    }

    .financial-value.total {
        font-size: 20px;
        color: var(--white);
    }

    .financial-card.highlight .financial-value {
        color: var(--white);
    }

    /* Tax Section */
    .tax-section {
        margin-bottom: 30px;
    }

    .tax-breakdown {
        background: var(--white);
        border-radius: var(--border-radius-lg);
        padding: 25px;
        box-shadow: var(--shadow);
        border: 1px solid rgba(25, 118, 210, 0.1);
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
        gap: 20px;
    }

    .tax-item {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 15px 20px;
        background: var(--light-color);
        border-radius: var(--border-radius);
        border: 1px solid rgba(25, 118, 210, 0.1);
    }

    .tax-label {
        font-weight: 600;
        color: var(--dark-color);
        font-size: 14px;
    }

    .tax-value {
        font-weight: 700;
        color: var(--success-color);
        font-size: 16px;
    }

    /* Items Section */
    .items-section {
        margin-bottom: 30px;
    }

    .items-grid {
        background: var(--white);
        border-radius: var(--border-radius-lg);
        box-shadow: var(--shadow);
        border: 1px solid rgba(25, 118, 210, 0.1);
        overflow: hidden;
    }

    .raw-material-cell {
        display: flex;
        flex-direction: column;
        gap: 4px;
    }

    .raw-material-name {
        font-weight: 600;
        color: var(--dark-color);
        font-size: 14px;
    }

    .raw-material-id {
        font-size: 12px;
        color: #666;
        opacity: 0.8;
    }

    .tax-details-cell {
        display: flex;
        flex-direction: column;
        gap: 2px;
    }

    .tax-row {
        font-size: 12px;
        color: var(--success-color);
        font-weight: 600;
    }

    .total-cell {
        text-align: right;
    }

    .total-amount {
        font-weight: 700;
        color: var(--primary-color);
        font-size: 15px;
        background: var(--primary-light);
        padding: 4px 8px;
        border-radius: 4px;
        display: inline-block;
    }

    /* Remarks Section */
    .remarks-section {
        margin-bottom: 30px;
    }

    .remarks-content {
        background: var(--white);
        border-radius: var(--border-radius-lg);
        padding: 25px;
        box-shadow: var(--shadow);
        border: 1px solid rgba(25, 118, 210, 0.1);
        border-left: 4px solid var(--primary-color);
    }

    .remarks-content p {
        margin: 0;
        color: var(--dark-color);
        font-size: 16px;
        line-height: 1.6;
        font-style: italic;
    }

    /* Modern Grid Styling */
    .modern-grid .e-grid .e-gridheader {
        background: linear-gradient(135deg, #f8f9fa, #ffffff);
        border-bottom: 2px solid var(--primary-color);
    }

    .modern-grid .e-grid .e-headercell {
        font-weight: 700;
        color: var(--dark-color);
        border-right: 1px solid #dee2e6;
        font-size: 13px;
    }

    .modern-grid .e-grid .e-row:hover {
        background: var(--primary-light);
    }

    .modern-grid .e-grid .e-altrow {
        background: #f8f9fa;
    }

    .modern-grid .e-grid .e-rowcell {
        border-right: 1px solid #e9ecef;
        padding: 12px 8px;
        font-size: 13px;
    }

    /* Animations */
    @@keyframes fadeInUp {
        from {
            opacity: 0;
            transform: translateY(40px);
        }
        to {
            opacity: 1;
            transform: translateY(0);
        }
    }

    @@keyframes dotPulse {
        0%, 80%, 100% {
            transform: scale(0);
        }
        40% {
            transform: scale(1);
        }
    }

    @@keyframes float {
        0%, 100% {
            transform: translateY(0px);
        }
        50% {
            transform: translateY(-20px);
        }
    }

    /* Confirm Delete Dialog Styles */
    .confirm-delete-dialog .e-dialog {
        border-radius: var(--border-radius-lg);
        box-shadow: 0 20px 40px rgba(0, 0, 0, 0.3);
        border: none;
    }
    
    .dialog-header {
        display: flex;
        align-items: center;
        gap: 15px;
        padding: 20px 25px;
        background: linear-gradient(135deg, #fff5f5, #ffebee);
        border-bottom: 1px solid #ffcdd2;
        border-radius: var(--border-radius-lg) var(--border-radius-lg) 0 0;
    }
    
    .dialog-icon.danger {
        width: 50px;
        height: 50px;
        background: linear-gradient(135deg, var(--danger-color), #d32f2f);
        color: var(--white);
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 20px;
        box-shadow: 0 4px 12px rgba(244, 67, 54, 0.3);
    }
    
    .dialog-title h3 {
        margin: 0;
        color: var(--danger-color);
        font-size: 22px;
        font-weight: 700;
    }
    
    .dialog-content {
        padding: 30px 25px;
    }
    
    .warning-message p {
        font-size: 18px;
        color: var(--dark-color);
        margin-bottom: 25px;
        text-align: center;
    }
    
    .delete-details {
        background: #f8f9fa;
        border-radius: var(--border-radius);
        padding: 20px;
        margin-bottom: 25px;
        border: 1px solid #e9ecef;
    }
    
    .detail-row {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 8px 0;
        border-bottom: 1px solid #e9ecef;
    }
    
    .detail-row:last-child {
        border-bottom: none;
    }
    
    .detail-row .label {
        font-weight: 600;
        color: #666;
        font-size: 14px;
    }
    
    .detail-row .value {
        font-weight: 700;
        color: var(--dark-color);
        font-size: 14px;
    }
    
    .detail-row .value.amount {
        color: var(--primary-color);
        font-size: 16px;
    }
    
    .warning-note {
        display: flex;
        align-items: flex-start;
        gap: 12px;
        background: #fff3e0;
        padding: 15px;
        border-radius: var(--border-radius);
        border-left: 4px solid var(--warning-color);
    }
    
    .warning-note i {
        color: var(--warning-color);
        font-size: 16px;
        margin-top: 2px;
        flex-shrink: 0;
    }
    
    .warning-note span {
        font-size: 14px;
        color: #663c00;
        line-height: 1.5;
    }
    
    .dialog-footer {
        display: flex;
        justify-content: flex-end;
        gap: 15px;
        padding: 20px 25px;
        background: #f8f9fa;
        border-top: 1px solid #e9ecef;
        border-radius: 0 0 var(--border-radius-lg) var(--border-radius-lg);
    }
    
    .dialog-footer .btn {
        display: flex;
        align-items: center;
        gap: 8px;
        padding: 12px 20px;
        border: none;
        border-radius: var(--border-radius);
        font-size: 14px;
        font-weight: 600;
        cursor: pointer;
        transition: var(--transition);
        min-width: 120px;
        justify-content: center;
    }
    
    .btn-cancel {
        background: #6c757d;
        color: var(--white);
    }
    
    .btn-cancel:hover:not(:disabled) {
        background: #5a6268;
        transform: translateY(-1px);
    }
    
    .btn-delete {
        background: linear-gradient(135deg, var(--danger-color), #d32f2f);
        color: var(--white);
        box-shadow: 0 4px 12px rgba(244, 67, 54, 0.3);
    }
    
    .btn-delete:hover:not(:disabled) {
        background: linear-gradient(135deg, #d32f2f, #b71c1c);
        transform: translateY(-1px);
        box-shadow: 0 6px 16px rgba(244, 67, 54, 0.4);
    }
    
    .btn:disabled {
        opacity: 0.6;
        cursor: not-allowed;
        transform: none !important;
    }
    
    .fa-spinner {
        animation: spin 1s linear infinite;
    }
    
    @@keyframes spin {
        0% { transform: rotate(0deg); }
        100% { transform: rotate(360deg); }
    }

    /* Responsive Design */
    @@media (max-width: 1024px) {
        .overview-cards {
            grid-template-columns: repeat(2, 1fr);
        }
        
        .financial-cards {
            grid-template-columns: repeat(3, 1fr);
        }
    }

    @@media (max-width: 768px) {
        .purchase-view-container {
            padding: 15px;
        }
        
        .page-header {
            padding: 25px 20px;
        }
        
        .header-content {
            flex-direction: column;
            gap: 20px;
        }
        
        .header-left {
            flex-direction: column;
            gap: 15px;
            width: 100%;
        }
        
        .header-title {
            justify-content: center;
        }
        
        .title-info h1 {
            font-size: 24px;
        }
        
        .overview-cards {
            grid-template-columns: 1fr;
        }
        
        .financial-cards {
            grid-template-columns: repeat(2, 1fr);
        }
        
        .tax-breakdown {
            grid-template-columns: 1fr;
        }
    }

    @@media (max-width: 768px) {
        .confirm-delete-dialog .e-dialog {
            width: 95% !important;
            margin: 20px;
        }
        
        .dialog-header {
            padding: 15px 20px;
        }
        
        .dialog-content {
            padding: 20px;
        }
        
        .dialog-footer {
            flex-direction: column;
            gap: 10px;
        }
        
        .dialog-footer .btn {
            width: 100%;
        }
        
        .detail-row {
            flex-direction: column;
            align-items: flex-start;
            gap: 5px;
        }
    }

    @@media (max-width: 480px) {
        .purchase-view-container {
            padding: 10px;
        }
        
        .page-header {
            padding: 20px 15px;
        }
        
        .title-info h1 {
            font-size: 20px;
        }
        
        .title-icon {
            width: 50px;
            height: 50px;
            font-size: 20px;
        }
        
        .financial-cards {
            grid-template-columns: 1fr;
        }
        
        .header-actions {
            flex-direction: column;
            width: 100%;
        }
        
        .action-btn {
            justify-content: center;
        }
    }
</style>