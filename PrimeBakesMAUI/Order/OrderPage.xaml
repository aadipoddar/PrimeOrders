<?xml version="1.0" encoding="utf-8" ?>
<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             x:Class="PrimeBakes.Order.OrderPage"
			 xmlns:control="clr-namespace:Syncfusion.Maui.Inputs;assembly=Syncfusion.Maui.Inputs"
			 xmlns:converters="clr-namespace:PrimeBakes.Converters"
			 xmlns:syncfusion="clr-namespace:Syncfusion.Maui.Popup;assembly=Syncfusion.Maui.Popup"
             Title="Order">

	<ContentPage.Resources>
		<ResourceDictionary>
			<converters:QuantityToVisibilityConverter x:Key="QuantityToVisibilityConverter" />

			<!-- Color Resources -->
			<Color x:Key="Primary">#2563EB</Color>
			<Color x:Key="PrimaryLight">#3B82F6</Color>
			<Color x:Key="Secondary">#64748B</Color>
			<Color x:Key="Success">#10B981</Color>
			<Color x:Key="Danger">#EF4444</Color>
			<Color x:Key="Background">#F8FAFC</Color>
			<Color x:Key="Surface">#FFFFFF</Color>
			<Color x:Key="OnSurface">#1E293B</Color>
			<Color x:Key="Border">#E2E8F0</Color>
		</ResourceDictionary>
	</ContentPage.Resources>

	<Grid>
		<Grid.RowDefinitions>
			<RowDefinition Height="Auto" />
			<RowDefinition Height="*" />
			<RowDefinition Height="Auto" />
		</Grid.RowDefinitions>

		<!-- Search Section -->
		<Border Grid.Row="0" 
		       Stroke="{StaticResource Border}"
		       StrokeShape="RoundRectangle 16"
		       Margin="20,0,20,10"
		       Padding="0">
			<Grid Padding="20,16">
				<Entry x:Name="searchTextBox" 
				       Placeholder="Search Products..." 
				       PlaceholderColor="MediumPurple"
				       TextColor="{StaticResource Primary}"
				       BackgroundColor="Transparent"
				       FontSize="16"
					   FontFamily="CascadiaCodeRegular"
				       TextChanged="searchTextBox_TextChanged" />
				<Label Text="ðŸ”" 
				       FontSize="18"
				       HorizontalOptions="End"
				       VerticalOptions="Center"
				       TextColor="{StaticResource Secondary}" />
			</Grid>
		</Border>

		<!-- Products List -->
		<ScrollView Grid.Row="1" 
		           Margin="20,10">
			<CollectionView x:Name="itemsCollectionView">
				<CollectionView.ItemTemplate>
					<DataTemplate>
						<Border Stroke="{StaticResource Border}"
								StrokeShape="RoundRectangle 12"
						        Margin="0,4"
						        Padding="0">
							<Grid Padding="20,16">
								<Grid.ColumnDefinitions>
									<ColumnDefinition Width="*" />
									<ColumnDefinition Width="Auto" />
								</Grid.ColumnDefinitions>

								<!-- Product Name -->
								<Label Text="{Binding ProductName}" 
								       Grid.Column="0"
								       FontSize="16"
									   Margin="5"
								       FontAttributes="None"
								       VerticalOptions="Center">
									<Label.GestureRecognizers>
										<TapGestureRecognizer Tapped="OnProductTapped" CommandParameter="{Binding}" />
									</Label.GestureRecognizers>
								</Label>

								<!-- Add Button (when quantity is 0) -->
								<Button Text="Add"
								        Grid.Column="1"
								        BackgroundColor="{StaticResource Primary}"
								        TextColor="White"
								        FontSize="14"
								        FontAttributes="None"
								        CornerRadius="8"
								        Padding="16,8"
								        MinimumWidthRequest="70"
								        Clicked="AddButton_Clicked"
								        IsVisible="{Binding Quantity, Converter={StaticResource QuantityToVisibilityConverter}, ConverterParameter=inverse}" />

								<!-- Quantity Controls (when quantity > 0) -->
								<StackLayout Grid.Column="1"
								           Orientation="Horizontal"
								           Spacing="8"
								           IsVisible="{Binding Quantity, Converter={StaticResource QuantityToVisibilityConverter}}">

									<!-- Decrease Button -->
									<Button Text="âˆ’"
									        BackgroundColor="Transparent"
									        TextColor="{StaticResource Danger}"
									        BorderColor="{StaticResource Border}"
									        BorderWidth="1"
									        FontSize="16"
									        FontAttributes="Bold"
									        CornerRadius="8"
									        WidthRequest="40"
									        HeightRequest="40"
									        Clicked="MinusButton_Clicked" />

									<!-- Quantity Display -->
									<control:SfNumericEntry x:Name="quantityNumericEntry"
									                        Value="{Binding Quantity}"
									                        BackgroundColor="Transparent"
															TextColor="MediumPurple"
									                        Stroke="{StaticResource Border}"
									                        WidthRequest="60"
									                        HeightRequest="40"
									                        CustomFormat="0"
									                        AllowNull="False"
									                        Minimum="0"
									                        UpDownPlacementMode="Hidden"
									                        HorizontalTextAlignment="Center"
									                        FontSize="14"
									                        ValueChanged="quantityNumericEntry_ValueChanged" />

									<!-- Increase Button -->
									<Button Text="+"
									        BackgroundColor="Transparent"
									        TextColor="{StaticResource Success}"
									        BorderColor="{StaticResource Border}"
									        BorderWidth="1"
									        FontSize="16"
									        FontAttributes="Bold"
									        CornerRadius="8"
									        WidthRequest="40"
									        HeightRequest="40"
									        Clicked="PlusButton_Clicked" />
								</StackLayout>
							</Grid>
						</Border>
					</DataTemplate>
				</CollectionView.ItemTemplate>
				<CollectionView.ItemsLayout>
					<LinearItemsLayout Orientation="Vertical" ItemSpacing="0" />
				</CollectionView.ItemsLayout>
			</CollectionView>
		</ScrollView>

		<!-- Cart Summary -->
		<Border Grid.Row="2"
				StrokeShape="RoundRectangle 16"
				BackgroundColor="MediumPurple"
				Margin="10,0,10,10"
				Padding="5">
			<Grid Padding="5">
				<Grid.ColumnDefinitions>
					<ColumnDefinition Width="*" />
					<ColumnDefinition Width="Auto" />
				</Grid.ColumnDefinitions>

				<!-- Cart Items Count -->
				<StackLayout Grid.Column="0"
				           VerticalOptions="Center">
					<Label x:Name="cartItemsLabel" 
					       Text="0 Items"
						   TextColor="Black"
						   FontFamily="CascadiaCodeRegular"
					       FontAttributes="Bold" />
					<Label Text="Review your order"
					       FontSize="10"
						   TextColor="Black"
						   FontFamily="CascadiaCodeRegular" />
				</StackLayout>

				<!-- Cart Button -->
				<Button Text="View Cart"
				        Grid.Column="1"
				        BackgroundColor="{StaticResource Primary}"
				        TextColor="White"
						FontFamily="CascadiaCodeRegular"
				        CornerRadius="12"
				        Padding="20,10"
				        MinimumWidthRequest="120"
				        Clicked="CartButton_Clicked" />
			</Grid>
		</Border>

		<syncfusion:SfPopup x:Name="productPopup" ShowCloseButton="True" ShowFooter="True" IsVisible="False" AutoSizeMode="Height">
			<syncfusion:SfPopup.HeaderTemplate>
				<DataTemplate>
					<Label Text="{Binding ProductName}" TextColor="Black" FontFamily="CascadiaCodeRegular" FontSize="20" HorizontalOptions="Center" VerticalOptions="Center" />
				</DataTemplate>
			</syncfusion:SfPopup.HeaderTemplate>
			
			<syncfusion:SfPopup.ContentTemplate>
				<DataTemplate>
					<Grid Padding="5" Margin="10">
						<Grid.ColumnDefinitions>
							<ColumnDefinition Width="*" />
							<ColumnDefinition Width="Auto" />
						</Grid.ColumnDefinitions>

						<Grid.RowDefinitions>
							<RowDefinition Height="Auto" />
							<RowDefinition Height="Auto" />
							<RowDefinition Height="Auto" />
							<RowDefinition Height="Auto" />
							<RowDefinition Height="Auto" />
							<RowDefinition Height="Auto" />
						</Grid.RowDefinitions>

						<Label Text="Quantity:" Grid.Row="0" Grid.Column="0" TextColor="Black" FontFamily="CascadiaCodeRegular" FontSize="18" />
						<Label Text="{Binding Quantity}" Grid.Row="0" Grid.Column="1" TextColor="Black" FontFamily="CascadiaCodeRegular" FontSize="18" HorizontalTextAlignment="End" />

						<Label Text="Rate:" Grid.Row="1" Grid.Column="0" TextColor="Black" FontFamily="CascadiaCodeRegular" FontSize="18" />
						<Label Text="{Binding Rate, StringFormat='â‚¹{0:N2}'}" Grid.Row="1" Grid.Column="1" TextColor="Black" FontFamily="CascadiaCodeRegular" FontSize="18" HorizontalTextAlignment="End" />

						<Label Text="Base Total:" Grid.Row="2" Grid.Column="0" TextColor="Black" FontFamily="CascadiaCodeRegular" FontSize="18" />
						<Label Text="{Binding BaseTotal, StringFormat='â‚¹{0:N2}'}" Grid.Row="2" Grid.Column="1" TextColor="Black" FontFamily="CascadiaCodeRegular" FontSize="18" HorizontalTextAlignment="End" />

						<Label Text="CGST:" Grid.Row="3" Grid.Column="0" TextColor="Black" FontFamily="CascadiaCodeRegular" FontSize="18" />
						<Label Text="{Binding CGSTPercent, StringFormat='â‚¹{0:N2}'}" Grid.Row="3" Grid.Column="1" TextColor="Black" FontFamily="CascadiaCodeRegular" FontSize="18" HorizontalTextAlignment="End" />

						<Label Text="SGST:" Grid.Row="4" Grid.Column="0" TextColor="Black" FontFamily="CascadiaCodeRegular" FontSize="18" />
						<Label Text="{Binding SGSTPercent, StringFormat='â‚¹{0:N2}'}" Grid.Row="4" Grid.Column="1" TextColor="Black" FontFamily="CascadiaCodeRegular" FontSize="18" HorizontalTextAlignment="End" />

						<Label Text="Net Rate:" Grid.Row="5" Grid.Column="0" TextColor="Black" FontFamily="CascadiaCodeRegular" FontSize="18" />
						<Label Text="{Binding NetRate, StringFormat='â‚¹{0:N2}'}" Grid.Row="5" Grid.Column="1" TextColor="Black" FontFamily="CascadiaCodeRegular" FontSize="18" HorizontalTextAlignment="End" />
					</Grid>
				</DataTemplate>
			</syncfusion:SfPopup.ContentTemplate>

			<syncfusion:SfPopup.FooterTemplate>
				<DataTemplate>
					<Label Text="{Binding Total, StringFormat='Grand Total: â‚¹{0:N2}'}" HorizontalOptions="Center" TextColor="Black" FontFamily="CascadiaCodeRegular" FontSize="20" />
				</DataTemplate>
			</syncfusion:SfPopup.FooterTemplate>
		</syncfusion:SfPopup>
	</Grid>
</ContentPage>